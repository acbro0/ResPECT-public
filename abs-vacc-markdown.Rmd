---
title: "Absenteeism-and-vaccination"
author: "Alexandria C. Brown"
date: "Nov 28, 2016"
output: pdf_document
---
The models will take a few hours to run.  When they are finished 
you can download the model outputs to your computer using scp
and work with them locally, which is helpful for creating plots.
Load the package used to create the
model or else the output doesn't make sense. While we're at it, load 
ggplot2 and dplyr also.

```{r}
library("pscl")
library("ggplot2")
library("dplyr")

load("/home/alexandria/Desktop/vacc-affect-abs-model-hurdle-no-masterid.RData")

summary(AbsentModelhurd)

load("/home/alexandria/Desktop/policy-affect-vacc-model2.RData")

summary(htype_model)     

```

Make some nice figures of the results.  

```{r}
vac <- summary(AbsentModelhurd)

vac_count <- data.frame(coef(vac)$count)

vac_zero <- data.frame(coef(vac)$zero)

vac_count$predictors <- rownames(vac_count)
vac_zero$predictors <- rownames(vac_zero)

vac_count <- filter(vac_count, predictors != "(Intercept)")
vac_zero <- filter(vac_zero, predictors != "(Intercept)")

vac_count$predictors <- c("vaccinated", 
                    "male", "2014", "2015", "URI exposure", 
                    "hand hygiene:usually", "hand hygiene:sometimes",
                    "hand hygiene:unknown", "age", "VA")

vac_zero$predictors <- c("vaccinated", 
                    "male", "2014", "2015", "URI exposure", 
                    "hand hygiene:usually", "hand hygiene:sometimes",
                    "hand hygiene:unknown", "age", "VA")

ggplot(vac_count, aes(x=predictors, y = exp(Estimate))) +                                                   
  theme_bw() + 
  geom_pointrange (aes (ymin = exp(Estimate-Std..Error), ymax = exp(Estimate+Std..Error))) +              
  coord_flip() +               
  geom_hline(aes(yintercept=1), lty=2) +           
  labs(y = "95% CI", x = NULL) +                 
  theme(axis.text = element_text(size=12),  axis.title=element_text(size=14,face="bold")) +
  ggtitle("Relative risk estimates for absenteeism in HCW who took at least 1 sick day")+
  theme(panel.grid.minor=element_blank())

ggplot(vac_zero, aes(x=predictors, y = exp(Estimate))) +                                                   
  theme_bw() + 
  geom_pointrange (aes (ymin = exp(Estimate-Std..Error), ymax = exp(Estimate+Std..Error))) +              
  coord_flip() +               
  geom_hline(aes(yintercept=1), lty=2) +           
  labs(y = "95% CI", x = NULL) +                 
  theme(axis.text = element_text(size=12),  axis.title=element_text(size=14,face="bold")) +
  ggtitle("Odds of HCP taking at least 1 sick day")+
  theme(panel.grid.minor=element_blank())

```

Here's the figure for the model that shows whether PS hospital type is associated 
with more vaccinated participants. 

```{r}
vac <- summary(htype_model)       

vac <- data.frame(coef(vac))

vac$predictors <- rownames(vac)

vac <- filter(vac, predictors != "(Intercept)")

vac$predictors <- c("VA", 
                    "male", "2014", "2015", "URI exposure", 
                    "hand hygiene:usually", "hand hygiene:sometimes",
                    "hand hygiene:unknown", "age")

levels(vac$predictors) <- c("VA", 
                    "male", "2014", "2015", "URI exposure", 
                     "hand hygiene:sometimes",
                   "hand hygiene:usually", "hand hygiene:unknown",
                   "age")

ggplot(vac, aes(x=predictors, y = exp(Estimate))) +                                                   
  theme_bw() + 
  geom_pointrange (aes (ymin = exp(Estimate-Std..Error), ymax = exp(Estimate+Std..Error))) +              
  coord_flip() +               
  geom_hline(aes(yintercept=1), lty=2) +           
  labs(y = "95% CI", x = NULL) +                 
  theme(axis.text = element_text(size=12),  axis.title=element_text(size=14,face="bold")) +
  ggtitle("Odds of HCP influenza vaccination") +
  theme(panel.grid.minor=element_blank())
   
```






















Model diagnostics.  This is model 1 run seperately for each group, as suggested by Derek.


```{r}
load("/home/lex/Desktop/vacc-affect-abs-model1-PSonly.RData")

vacc_modelPS <- vacc_model

summary(vacc_modelPS)

load("/home/lex/Desktop/vacc-affect-abs-model1-VAonly.RData")

vacc_modelVA <- vacc_model

summary(vacc_modelVA)     
```

Make some figures of the results.  

```{r}
vac <- summary(vacc_modelVA)

vac <- data.frame(vac$solutions)

vac$predictors <- rownames(vac)

vac <- filter(vac, predictors != "(Intercept)")

vac$predictors <- c("vaccinated",
                    "male", "2014", "2015", "URI exposure", 
                    "hand hygiene", "age")

ggplot(vac, aes(x = predictors, y = post.mean)) +     
    ggtitle("Absenteeism Predictors within VA") +
  theme_bw() + 
  geom_pointrange (aes (ymin = l.95..CI, ymax = u.95..CI)) +              
  coord_flip() +               
  geom_hline(aes(yintercept=0), lty=2) +           
  labs(y = "95% CI", x = NULL) +                 
  theme(axis.text = element_text(size=12),  axis.title=element_text(size=14,face="bold"))   

vac <- summary(vacc_modelPS)

vac <- data.frame(vac$solutions)

vac$predictors <- rownames(vac)

vac <- filter(vac, predictors != "(Intercept)")

vac$predictors <- c("vaccinated",
                    "male", "2014", "2015", "URI exposure", 
                    "hand hygiene", "age")

ggplot(vac, aes(x = predictors, y = post.mean)) +                                                   
  ggtitle("Absenteeism Predictors within PS") +
  theme_bw() + 
  geom_pointrange (aes (ymin = l.95..CI, ymax = u.95..CI)) +              
  coord_flip() +               
  geom_hline(aes(yintercept=0), lty=2) +           
  labs(y = "95% CI", x = NULL) +                 
  theme(axis.text = element_text(size=12),  axis.title=element_text(size=14,face="bold"))   
```

